image: gitlab-registry.cern.ch/ci-tools/ci-worker:cc7

stages:
    - lint
    - test

before_script:
    - source /cvmfs/lhcb.cern.ch/lib/LbEnv
    - lb-conda-dev virtual-env default/2020-11-18 .venv
    - .venv/run pip install -r requirements.txt

flake8:
    stage: lint
    script:
        - .venv/run flake8 pidcalib2
    allow_failure: true

mypy:
    stage: lint
    script:
        - .venv/run mypy pidcalib2
    allow_failure: true

run_tests:
    stage: test
    script:
        - .venv/run pytest -v -m "not xrootd"
